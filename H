%-----------------------------------QC-LDPC校验矩阵的构造--------------------------------------%
function [qcH,Hb]=QCLDPCBaseH(Nbit,Rate) %qcH要求的QC-LDPC的校验矩阵，Hb已知的基校验矩阵，Nbit即码长n,Rate即码率
% nb,mb 分别为基校验矩阵的列和行，在该标准中，不同码率对应的基校验矩阵，nb值都为24，mb的值不相同
% z 为扩展因子，z=Nbit/nb
Rate=0.5;
Nbit=576;
nb=24;
z=Nbit/nb;
mb=nb-nb*Rate;
kb=nb-mb;                %基校验矩阵的左半部分的列数
Hz=zeros(z);             %构造一个z*z的矩阵，默认为全零矩阵
%IEEE 802.16e标准的LDPC码基校验矩阵具有固定的矩阵形式
Hb=[
-1 94 73 -1 -1 -1 -1 -1 55 83 -1 -1 7 0 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ;
-1 27 -1 -1 -1 22 79 9 -1 -1 -1 12 -1 0 0 -1 -1 -1 -1 -1 -1 -1 -1 -1;
-1 -1 -1 24 22 81 -1 33 -1 -1 -1 0 -1 -1 0 0 -1 -1 -1 -1 -1 -1 -1 -1;
61 -1 47 -1 -1 -1 -1 -1 65 25 -1 -1 -1 -1 -1 0 0 -1 -1 -1 -1 -1 -1 -1;
-1 -1 39 -1 -1 -1 84 -1 -1 41 72 -1 -1 -1 -1 -1 0 0 -1 -1 -1 -1 -1 -1;
-1 -1 -1 -1 46 40 -1 82 -1 -1 -1 79 0 -1 -1 -1 -1 0 0 -1 -1 -1 -1 -1;
-1 -1 95 53 -1 -1 -1 -1 -1 14 18 -1 -1 -1 -1 -1 -1 -1 0 0 -1 -1 -1 -1;
-1 11 73 -1 -1 -1 2 -1 -1 47 -1 -1 -1 -1 -1 -1 -1 -1 -1 0 0 -1 -1 -1;
12 -1 -1 -1 83 24 -1 43 -1 -1 -1 51 -1 -1 -1 -1 -1 -1 -1 -1 0 0 -1 -1;
-1 -1 -1 -1 -1 94 -1 59 -1 -1 70 72 -1 -1 -1 -1 -1 -1 -1 -1 -1 0 0 -1;
-1 -1 7 65 -1 -1 -1 -1 39 49 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 0 0;
43 -1 -1 -1 -1 66 -1 41 -1 -1 -1 26 7 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 0];

%HbNew是基校验矩阵Hb更新后的值
HbNew=zeros(size(Hb));

for  i=1:mb
     for j=1:nb
         if Hb(i,j)<0                %当q(i,j)=-1,z*z全零矩阵置换
            Hz=zeros(z);
         elseif Hb(i,j)==0           %当q(i,j)=0,z*z单位矩阵置换
            Hz=eye(z);               %返回z*z的单位矩阵，因为Hb(i,j)==0，不用向右循环
         else
%码率为1/2,2/3(B类)，3/4（A,B类），5/6
             HbNew(i,j)=floor(Hb(i,j)*z/96);     %先把HbNew的值更新，floor(x)为取<=x的整数
             Hz=circshift(eye(z),[0,HbNew(i,j)]) %将z矩阵向右循环floor(x)个单位长度
         end
         %进行水平拼接
         if j==1
             SubH=Hz;
         else
             SubH=horzcat(SubH,Hz);
         end
     end
     %进行垂直拼接
      if i==1
         qcH=SubH;
      else
         qcH=vertcat(qcH,SubH);
      end
end
